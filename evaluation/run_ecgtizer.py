"""
ECGtizer.py

Save Figure 10 generated by ecgtizer.plot_over()
- NO display
- Output image size == PDF page size
"""

import sys
from pathlib import Path

# Add baselines/ to PYTHONPATH
PROJECT_ROOT = Path(__file__).resolve().parents[1]
BASELINES_DIR = PROJECT_ROOT / "baselines"
sys.path.insert(0, str(BASELINES_DIR))

from ecgtizer.ecgtizer import ECGtizer

import matplotlib
matplotlib.use("Agg")
import matplotlib.pyplot as plt


import warnings
warnings.filterwarnings("ignore")


# =================================================
# CONFIG
# =================================================
PROJECT_ROOT = Path(__file__).resolve().parents[1]
#INPUT_PDF = PROJECT_ROOT / "baselines"  / "ecgtizer" / "data" / "PTB-XL" / "PDF" / "0607458.pdf"
INPUT_PDF = PROJECT_ROOT / "data" / "example_inputs" / "0607458.pdf"

OUTPUT_DIR = PROJECT_ROOT / "outputs" / "ecgtizer" / "figs"
OUTPUT_DIR.mkdir(parents=True, exist_ok=True)

DPI = 300   # gi·ªØ ƒë√∫ng DPI PDF


# =================================================
# Main
# =================================================
def main():
    if not INPUT_PDF.exists():
        raise FileNotFoundError(f"Missing PDF: {INPUT_PDF}")

    ecg_extracted = ECGtizer(
        str(INPUT_PDF),
        DPI,
        extraction_method="full",
        verbose=False,
        DEBUG=True
    )

    # ---- Create figure (no display) ----
    ecg_extracted.plot_over()

    # ---- Get current figure ----
    fig = plt.gcf()

    # ---- Save EXACT figure size (no enlargement) ----
    out_path = OUTPUT_DIR / f"fig10_global_ecg_{INPUT_PDF.stem}.png"
    fig.savefig(
        out_path,
        dpi=DPI,
        bbox_inches="tight",
        pad_inches=0
    )

    plt.close("all")

    print(f"üñºÔ∏è Saved Figure 10 (PDF-sized): {out_path}")


if __name__ == "__main__":
    main()